{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 col-md-8 offset-md-2">
                <hr>
                <h2 class="logo-font mb-4 text-center">Contact Us</h2>
                <hr>
                <p class="text-center">Have a question or a bulk order enquiry? Fill out the form below and we'll get back to you as soon as possible!</p>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-md-6 offset-md-3">
                <form action="{% url 'enquiry' %}" method="POST" class="mb-5">
                    {% csrf_token %}
                    {{ form | crispy }}
                    <div class="text-center">
                        <button class="btn blue-background rounded-0 mt-5" type="submit">Send Message</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block postloadjs %}
{{ block.super }} {# This is important to include parent block's JS, like toast messages #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const messageTypeSelect = document.getElementById('id_message_type');
        const orderNumberContainer = document.getElementById('order-number-container');
        const orderNumberField = document.getElementById('id_order_number'); // Get the actual input field

        // Function to toggle visibility and required status
        function toggleOrderNumberField() {
            const selectedValue = messageTypeSelect.value;
            // The value 'problem' comes from your EnquiryForm.MESSAGE_TYPES
            // You'll need to check the exact value for 'Other' if you add one,
            // or iterate through your choices for 'problem' and 'other' values.
            // For example, if 'Other' is mapped to 'other' in your form choices:
            const showField = (selectedValue === 'problem' || selectedValue === 'other');

            if (showField) {
                $(orderNumberField).slideDown();
                if (selectedValue ==='problem'){
                    orderNumberField.setAttribute('required', 'required');
                    orderNumberField.setAttribute('placeholder', 'Order Number *')
                }
                else{
                    orderNumberField.setAttribute('placeholder', 'Order Number (Optional)')
                }
            } else {
                $(orderNumberField).slideUp();
                orderNumberField.removeAttribute('required'); // Remove required when hidden
                orderNumberField.value = '';
            }
        }

        toggleOrderNumberField();

        messageTypeSelect.addEventListener('change', toggleOrderNumberField);
    });

</script>
{% endblock %}